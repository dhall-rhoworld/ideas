<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head> 
    <title>RhoVer Bivariate Plot</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="/rhover.css"/>
    <link rel="stylesheet" href="/jquery-ui.css"/>
    <link rel="icon" type="image/png" href="/images/rover-favicon.png" />
    <script src="/d3.min.js"></script>
    <script src="/jquery-3.2.1.min.js"></script>
    <script src="/jquery-ui.js"></script>
    <script src="/bivariate_scatter.js"></script>
    
    <script th:inline="javascript">
    	fieldInstanceId1 = [[${fieldInstance1.fieldInstanceId}]];
    	fieldInstanceId2 = [[${fieldInstance2.fieldInstanceId}]];
    	const url = "/rest/anomaly/data/bivariate_outliers?check_run_id=" + [[${check_run_id}]];
    	const fieldName1 = [[${field_name_1}]];
    	const fieldName2 = [[${field_name_1}]];
    	const slope = parseFloat([[${slope}]]);
    	const intercept = parseFloat([[${intercept}]]);
    	let cutoffResidual = parseFloat([[${cutoff_residual}]]);
    	const sdRes = parseFloat([[${sd_res}]]);
    	const heteroschedastic = [[${heteroschedastic}]];
    	const lambda = [[${lambda}]];
    </script>
</head>
<body>
	<div class="page-header">RhoVer (Prototype)</div>
	
	<div id="breadcrumbs">
		<a href="/browse/studies">Studies</a>
		>
		
		<!-- Showing all anomalies from study -->
		<span th:if="${site == null and subject == null}">
			<a th:href="@{/browse/datasets(study_id=${study.studyId})}" th:text="${study.studyName}"/>
			>
			<a th:href="@{/browse/data_fields(dataset_id=${dataset.datasetId})}" th:text="${dataset.datasetName}"/>
		</span>
		
		>
		[<a th:text="${fieldInstance1.field.displayName}" th:href="@{/anomaly/beeswarm(field_id=${fieldInstance1.field.fieldId}, dataset_id=${dataset.datasetId})}"/>
		X
		 <a th:text="${fieldInstance2.field.displayName}" th:href="@{/anomaly/beeswarm(field_id=${fieldInstance2.field.fieldId}, dataset_id=${dataset.datasetId})}"/>
		]
	</div>
	
	<div id="content">
		<div>
			<fieldset class="control-group">
				<legend>Check Parameters</legend>
				<label for="spinner_sd_residual">SD from line</label>
				<input id="spinner_sd_residual" size="2" th:value="${sd_residual}"/>
				<label for="spinner_sd_density">SD below mean density</label>
				<input id="spinner_sd_density" size="2" th:value="${sd_density}"/>
				<label for="spinner_neighbors">Neighbors used for density</label>
				<input id="spinner_neighbors" size="2" th:value="${num_nearest_neighbors}"/>
				<button type="button">Apply</button>
			</fieldset>
		</div>
		<div id="chart"/>
	</div>
</body>

<script>
	function onSdResidualChange() {
		const sd = parseFloat($("#spinner_sd_residual").val());
		cutoffResidual = sd * sdRes;
		drawHeteroschedasticThresholds();
	}
	
	function onSdDensityChange() {
		
	}
	
	function onNeighborsChange() {
		
	}
	
	$("#spinner_sd_residual").spinner({
		step: 0.25,
		numberFormat: "n",
		stop: function() {
			onSdResidualChange();
		}
	});
	
	$("#spinner_sd_density").spinner({
		step: 0.25,
		numberFormat: "n",
		stop: function() {
			onSdDensityChange();
		}
	});
	
	$("#spinner_neighbors").spinner({
		step: 1,
		numberFormat: "n",
		stop: function() {
			onNeighborsChange();
		}
	});
</script>
</html>