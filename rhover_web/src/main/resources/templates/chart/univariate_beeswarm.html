<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head> 
    <title>RhoVer Beeswarm Chart</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="/rhover.css"/>
    <link rel="stylesheet" href="/jquery-ui.css"/>
    <link rel="icon" type="image/png" href="/images/rover-favicon.png" />
    <script src="/d3.min.js"></script>
    <script src="/jquery-3.2.1.min.js"></script>
    <script src="/jquery-ui.js"></script>
    <script src="/chart/beeswarm.js"></script>
    <script src="/page/univariate_beeswarm.js"></script>
    
    <script src="/jquery.contextMenu.min.js"></script>
    <script src="/jquery.ui.position.min.js"></script>
    <link rel="stylesheet" href="/jquery.contextMenu.min.css"/>
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
</head>
<body>

	<!-- Bread crumbs -->
	<div id="breadcrumbs">
		<a href="/browse/studies">Studies</a>
		>
		
		<!-- Showing all anomalies from study -->
		<span th:if="${site == null and subject == null}">
			<a th:href="@{/browse/datasets(study_id=${field.study.studyId})}" th:text="${field.study.studyName}"/>
			>
			<a th:href="@{/browse/data_fields(dataset_id=${dataset.datasetId})}" th:text="${dataset.datasetName}"/>
		</span>
		
		<!-- Showing anomalies from one site -->
		<span th:if="${site}">
			<a th:href="@{/browse/sites(study_id=${site.study.studyId})}" th:text="${site.study.studyName}"/>
			>
			<a th:href="@{/browse/datasets(site_id=${site.siteId})}" th:text="'Site ' + ${site.siteName}"/>
			>
			<a th:href="@{/browse/data_fields(dataset_id=${dataset.datasetId}, site_id=${site.siteId})}" th:text="${dataset.datasetName}"/>
		</span>
		
		<!-- Showing anomalies from one subject -->
		<span th:if="${subject}">
			<a th:href="@{/browse/subjects(study_id=${subject.site.study.studyId})}" th:text="${subject.site.study.studyName}"/>
			>
			<a th:href="@{/browse/datasets(subject_id=${subject.subjectId})}" th:text="'Subject ' + ${subject.subjectName}"/>
			>
			<a th:href="@{/browse/data_fields(dataset_id=${dataset.datasetId}, subject_id=${subject.subjectId})}" th:text="${dataset.datasetName}"/>
		</span>
		>
		<strong><span th:text="${field.fieldLabel}"/></strong>
	</div>
	<!-- End bread cumbs -->
	
	<!-- Main content -->
	<div id="content">
	
		<div class="container">
			<div id="filters_bar" class="container"/>
			<div id="highlights_bar" class="container"/>
			<div id="groupby_bar" class="container"/>
		</div>
	
		<!-- Data check parameters -->
		<img id="img_boundary" src="/images/info.png" width="20" height="20" 
			title="Numer of standard deviations from the mean above which a value is considered an outlier. (Current value shown as vertical dashed lines in chart). Changes to this setting will only be applied to this variable. Pressing Apply button will trigger an immediate run of the data check with the specified setting, which will also be saved and used in future data check runs."
			/>
		<label for="spinner_sd">Outlier Boundary (stdev from mean)</label>
		<input id="spinner_sd" size="2" th:value="${num_sd}"/>
		<button type="button" id="button_boundary">Apply</button>
	
		<!-- Chart -->
		<div>
			<svg/>
		</div>

		<!-- X-axis label -->
		<h3 th:text="${field.fieldLabel}"/>
	</div>
	<!-- End main content -->
		
	<!-- Dialogs -->
	<div>
	
		<!-- Dialog for showing data selected by user -->
		<div id="dialog_data">
    		<table id="dialog_data_table" class="wide"/>
    	</div>
    	
    	<!-- Dialog for navigating to other charts -->
    	<div id="dialog_charts">
    		<table class="invisible">
    			<tr>
    				<td>
    				 	<img src="/images/scatterplot.png"/>
    				</td>
    				<td>
    					Plot relationship with second variable (scatter plot)
    					<p>
		    				<input type="text" value="Enter second variable" class="input_hint"
		    					id="text_second_field"
		    				/>
		    				<button type="button" id="button_scatter">Go</button>
		    			</p>
    				</td>
    			</tr>
    		</table>
    	</div>
    	
    	<!-- Chart options dialog -->
    	<div id="dialog_controls" style="text-align: center;">
    		<fieldset style="margin: 20px; background-color: #f6f6f6; border: 1px solid black;">
				<legend style="font-weight: bold;">Data Filters</legend>
				<table class="invisible">
					<tr>
						<th th:text="${site_field_name}"/>
						<th th:text="${phase_field_name}"/>
					</tr>
					<tr>
						<td>
							<select multiple="true" id="filter_site" th:name="'filter-' + ${site_field_name}">
								<option th:each="site : ${sites}" th:text="${site.siteName}"/>
							</select>
						</td>
						<td>
							<select multiple="true" id="filter_phase" th:name="'filter-' + ${phase_field_name}">
								<option th:each="phase : ${phases}" th:text="${phase.phaseName}"/>
							</select>
						</td>
					</tr>
				</table>
				<p><button type="button" id="filter_remove">Remove All</button></p>
			</fieldset>
			
			<fieldset style="margin: 20px; background-color: #f6f6f6; border: 1px solid black;">
				<legend style="font-weight: bold;">Group Data By</legend>
				<table class="grid">
					<tr>
						<td><input type="radio" name="group_by" value="none" checked="true"/></td>
						<td align="left">Do not group</td>
					</tr>
				 	<tr>
						<td><input type="radio" name="group_by" th:value="${site_field_name}"/></td>
						<td align="left" th:text="${site_field_name}"/>
					</tr>
					<tr>
						<td><input type="radio" name="group_by" th:value="${phase_field_name}"/></td>
						<td align="left" th:text="${phase_field_name}"/>
					</tr>
				</table>
			</fieldset>
			
			<fieldset style="margin: 20px; background-color: #f6f6f6; border: 1px solid black;">
				<legend style="font-weight: bold;">Highlight Data</legend>
				<table class="invisible">
					<tr>
						<th th:text="${site_field_name}"/>
						<th th:text="${phase_field_name}"/>
					</tr>
					<tr>
						<td>
							<select multiple="true" id="highlight_site" th:name="'highlight-' + ${site_field_name}">
								<option th:each="site : ${sites}" th:text="${site.siteName}"/>
							</select>
						</td>
						<td>
							<select multiple="true" id="highlight_phase" th:name="'highlight-' + ${phase_field_name}">
								<option th:each="phase : ${phases}" th:text="${phase.phaseName}"/>
							</select>
						</td>
					</tr>
				</table>
				<p><button type="button" id="highlight_remove">Remove All</button></p>
			</fieldset>
			
		</div>
		<!-- End chart options dialog -->
		
	</div>
    <!-- End dialogs -->
</body>

<!-- Script to initialize Javascript variables -->
<script th:inline="javascript">
	const url = "/rest/anomaly/data/univariate_outliers?check_run_id=" + [[${check_run_id}]];
	const mean = parseFloat([[${mean}]]);
	const sd = parseFloat([[${sd}]]);
	const siteName = [[${site_name}]];
	const subjectName = [[${subject_name}]];
	const numSd = parseFloat([[${num_sd}]]);
	const siteFieldName = [[${site_field_name}]];
	const phaseFieldName = [[${phase_field_name}]];
	const subjectFieldName = [[${subject_field_name}]];
	const recordIdFieldName = [[${record_id_field_name}]];
	const studyId = [[${field.study.studyId}]];
	const datasetName = [[${dataset.datasetName}]];
	const datasetId = [[${dataset.datasetId}]];
	const fieldName1 = [[${field.fieldName}]];
	
	// TODO: Consider consolidating this variable with fieldName1 below
	const fieldName = [[${field_name}]];
</script>

</html>