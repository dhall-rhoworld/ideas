<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head> 
    <title>RhoVer Anomaly Chart</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="/rhover.css"/>
    <script src="/d3.min.js"></script>
</head>
<body>
	<svg width="980" height="440"/>
</body>
	<script>
		const CIRCUMFERENCE = 5;
		const data = [3000, 5000, 5010, 5020, 5030, 6000, 6002, 9000]
		
		const laneIndex = new Array(500);
		const laneMax = new Array(500);
		let numLanes = 1;
		laneIndex[0] = 0;
		laneMax[0] = d3.min(data) - 100;
		
		const xScale = d3.scaleLinear()
			.domain([d3.min(data), d3.max(data)])
			.range([0, 900]);
		
		function getY(x) {
			let lane = 0;
			while (lane < numLanes && (laneMax[lane] + 2 * CIRCUMFERENCE) > x) {
				lane++;
			}
			laneMax[lane] = x;
			if (lane == numLanes) {
				numLanes++;
				if (laneIndex[lane - 1] == 0) {
					laneIndex[lane] = -1;
				}
				else if (laneIndex[lane - 1] < 0) {
					laneIndex[lane] = -laneIndex[lane - 1];
				}
				else {
					laneIndex[lane] = -laneIndex[lane - 1] - 1;
				}
			}
			let y = laneIndex[lane] * 2 * CIRCUMFERENCE;
			console.log(x + ", " + y);
			return y;
		}
		
		const viewport = d3.select("svg")
			.append("g")
			.attr("transform", "translate(40, 40)");
		
		const midPoint = viewport.append("g").attr("transform", "translate(0, 175)")
	
		midPoint.selectAll("circle")
			.data(data)
			.enter()
			.append("circle")
			.attr("cx", function(d) {return xScale(d);})
			.attr("cy", function(d) {return getY(xScale(d));})
			.attr("r", CIRCUMFERENCE)
			.style("fill", "purple");
		
		var xAxis = d3.axisBottom().scale(xScale);
		var xAxisGroup = viewport.append("g")
			.attr("transform", "translate(0, 300)")
			.call(xAxis);
	</script>
</html>