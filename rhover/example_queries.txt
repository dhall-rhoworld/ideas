select df.data_field_id, df.data_field_name, count(a.anomaly_id), count(a.has_been_viewed = 0)
from data_field df
join anomaly a on a.data_field_id = df.data_field_id
where df.dataset_id = 1
group by df.data_field_id, df.data_field_name

select ds.dataset_id, ds.dataset_name, count(a.anomaly_id), count(a.has_been_viewed = 0)
from dataset ds
join data_field df on df.dataset_id = ds.dataset_id
join anomaly a on a.data_field_id = df.data_field_id
where ds.study_id = 1
group by ds.dataset_id, ds.dataset_name

select s.study_id, s.study_name, count(a.anomaly_id), count(a.has_been_viewed = 0)
from study s
join dataset ds on ds.study_id = s.study_id
join data_field df on df.dataset_id = ds.dataset_id
join anomaly a on a.data_field_id = df.data_field_id
group by s.study_id, s.study_name

select a.recruit_id, a.event, a.field_value, dsv1.dataset_version_name, dsv2.dataset_version_name
from anomaly a
join dataset_version dsv1 on a.version_first_seen_in = dsv1.dataset_version_id
join dataset_version dsv2 on a.version_last_seen_in = dsv2.dataset_version_id
where a.data_field_id = 1
order by a.recruit_id, a.event

select max(version_last_seen_in) from anomaly where data_field_id = 1;

select s.study_name
from data_field df
join dataset ds on ds.dataset_id = df.dataset_id
join study s on s.study_id = ds.study_id
where df.data_field_id = 1

select ds.dataset_name
from dataset ds
join data_field df on df.dataset_id = ds.dataset_id
where df.data_field_id = 1