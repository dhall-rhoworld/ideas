/* MySQL root account: root@localhost/password */

create database rhover;
create user 'rhover'@'localhost' identified by 'rhover';
grant all privileges on rhover.* to 'rhover'@'localhost';

create table study (
	study_id BIGINT AUTO_INCREMENT PRIMARY KEY,
	study_name VARCHAR(50),
	last_modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

create table dataset (
	dataset_id BIGINT AUTO_INCREMENT PRIMARY KEY,
	dataset_name VARCHAR(50),
	study_id BIGINT,
	last_modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	foreign key(study_id) references study(study_id)
);

create table dataset_version (
	dataset_version_id BIGINT AUTO_INCREMENT PRIMARY KEY,
	dataset_version_name VARCHAR(50),
	dataset_id BIGINT,
	last_modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	foreign key(dataset_id) references dataset(dataset_id)
);

create table outlier (
	outlier_id BIGINT AUTO_INCREMENT PRIMARY KEY,
	field_name VARCHAR(100),
	field_value VARCHAR(100),
	dataset_id BIGINT,
	version_first_seen_in BIGINT,
	version_last_seen_in BIGINT,
	recruit_id VARCHAR(100),
	event VARCHAR(100),
	foreign key(dataset_id) references dataset(dataset_id),
	foreign key(version_first_seen_in) references dataset_version(dataset_version_id),
	foreign key(version_last_seen_in) references dataset_version(dataset_version_id)
);
